function ShowProductTree(){$("#searchDiv").fadeIn("slow"),$("#matchtextbox").focus(),$("#closeTreeDiv").fadeIn("slow"),$("#tree").fadeIn("slow"),$("#RegionList").hide()}function ShowDetails(e){$("#cancleBtn").hide(),$("#exitBtn").show(),$.ajax({url:"/IdeaStorage.srv",data:{IdeaDerivedId:e,IsDetails:!0,BehaviorType:"read"},type:"POST",cache:!1,success:function(e){var t=$.parseJSON(e),a=t._ContentIdeaList;$.each(a,function(e,t){if($("#TitleInput").val(t.Title),$("#audienceCkx input:checkbox").each(function(e,a){-1!=unescape(t.Audience).indexOf($(this).val())&&$(this).attr("checked",!0)}),$("#suggAssetTypeCks input:checkbox").each(function(e,a){-1!=unescape(t.SuggestedAssetType).indexOf($(this).val())&&$(this).attr("checked",!0)}),$("#PriorityDrp").val(t.TriagePriority),$("#ReqDetailsDrp").val(t.RequestDetails),""!=t.PesProductIds&&null!=t.PesProductIds){var a=unescape(t.TreeNodes);a=$.parseXML(a);var i=(unescape(t.TreeHtml),$(a).find("all")),s={id:i.attr("id"),Text:i.attr("text"),value:i.attr("value"),showcheck:"true"==i.attr("showcheck")?!0:!1,complete:"true"==i.attr("complete")?!0:!1,isexpand:"true"==i.attr("isexpand")?!0:!1,checkstate:i.attr("checkstate"),hasChildren:"true"==i.attr("hasChildren")?!0:!1,Level:"0"};if($(a).find("all").children().length>0){var r=CreateDataSource(s,$(a).find("all").children(),0);s.ChildNodes=r,o.data=[s],identifier=!1,$("#tree").treeview(o),$("#tree").height(parseInt(t.TreeHeight)),$("#closeTreeDiv").height(parseInt(t.TreeHeight)+20),$("#calculatingDiv").height(parseInt(t.TreeHeight)),$("#tree").width(parseInt(t.TreeWidth)),$("#closeTreeDiv").width(parseInt(t.TreeWidth)),$("#searchDiv").width(parseInt(t.TreeWidth)),$("#matchtextbox").width(parseInt(t.TreeWidth)-10),$("#productsNameList").width(parseInt(t.TreeWidth)),$("#calculatingDiv").width(parseInt(t.TreeWidth)),$("#calculatingPar").css("margin-top",(parseInt(t.TreeHeight)+28-72)/2),$("#txtProductTree").attr("value","Selected "+t.TreeItems+" items"),selectedProducts=t.TreeID+",",$("#txtProductTreeHidden").attr("value",selectedProducts)}}$("#SupportTopic").val(t.SupportTopic),supportTopicId=t.SupportTopicId,$("#Description").val(t.Description),$("#BusiJustification").val(t.BusinessJustification),$("#RequestedBy").val(t.Requestedby),$("#RequestedBy").removeClass("inputTxt")})},error:function(e){}})}function AutoFillInForm(e){supportTopicId=e.SupportId;var t="Between "+e.startDate+" and "+e.endDate+" , Labor hour is "+e.Labor+"; TMPI is "+e.TMPI+"; CaseVolume is "+e.CaseVol+"; Top box is "+e.TB+" ; bottom box is "+e.BB;$("#SupportTopic").val(e.FullPath.replace(/\^/g,"\\")),$("#BusiJustification").val(t),$("#RequestedBy").val(e.UserName+"@microsoft.com"),$("#RequestedBy").removeClass("inputTxt")}function SubmitIdea(){var e=ValidateInput();if(0==e)return!1;titleVal=$("#TitleInput").val(),assetTypeVal=GetSelectedValues("suggAssetTypeCks"),priorityVal=$("#PriorityDrp").val(),requestedDetailsVal=$("#ReqDetailsDrp").val();var t=$("#txtProductTreeHidden").val();pesProdIdsVal=t.substring(0,t.length-1),descriptionVal=$("#Description").val(),busiJustVal=$("#BusiJustification").val(),requestedByVal=$("#RequestedBy").val(),audienceVal=GetSelectedValues("audienceCkx");var a="",i="",s="",r="",l="",o="";if(""!=pesProdIdsVal){a=$("#tree").html(),a=escape(a),s=$("#tree").height(),r=$("#tree").width(),i=pesProdIdsVal,o="<all id='allid' text='all' value='all' showcheck='false' complete='true' checkstate='0' isexpand='true' hasChildren='true'>",o=LoopNodes(allNodes[0].ChildNodes,o,0),o+="</all>",o=escape(o);var c=$("#txtProductTree").val();l=c.match(/\d+/)[0]}var d={TreeHtml:a,TreeHeight:s,TreeWidth:r,TreeID:i,TreeNodes:o,TreeItems:l},u={IdeaDerivedId:ideaDerivedId,Title:titleVal,SupportTopicId:supportTopicId,Audience:audienceVal,SuggAssetType:assetTypeVal,Priority:priorityVal,ReqDetails:requestedDetailsVal,PesProductIDs:pesProdIdsVal,SupportTopic:$("#SupportTopic").val(),Description:descriptionVal,BusJustification:busiJustVal,RequestedBy:requestedByVal,ProductTree:d};$("#loadImageDiv").show(),$.ajax({url:"/IdeaStorage.srv",data:u,type:"POST",cache:!1,success:function(e){var t=$.parseJSON(e);if(t.IsSuccess){var a=t.SuccessMsg;null!=t.ErrorMsgList&&t.ErrorMsgList.length>0&&(a+=" \n"+t.ErrorMsgList),alert(a)}else{var i="";i+=t.ErrorMsgList,alert(i)}$("#loadImageDiv").hide(),t.IsSuccess&&window.close()},error:function(e){alert("failed to submit!"),$("#loadImageDiv").hide()}})}function LoopNodes(e,t,a){var i="";return a+=1,$.each(e,function(e,s){null!=s.ChildNodes?(t=t+"<SupportLevel"+a+" id='"+s.id+"' text='"+s.Text+"' value='"+s.Value+"' showcheck='"+s.showcheck+"' complete='"+s.complete+"' checkstate='"+s.checkstate+"' isexpand='"+!0+"' hasChildren='"+s.hasChildren+"'>",i=LoopNodes(s.ChildNodes,t,a),t=i):t=t+"<SupportLevel"+a+" id='"+s.id+"' text='"+s.Text+"' value='"+s.Value+"' showcheck='"+s.showcheck+"' complete='"+s.complete+"' checkstate='"+s.checkstate+"' isexpand='"+!1+"' hasChildren='"+s.hasChildren+"'>",t=t+"</SupportLevel"+a+">",i=t}),i}function show_confirm(){var e=confirm("Submit successfully!\r\rClick [OK] to view idea lists");1==e&&window.open("idealists.aspx")}function CancleIdea(){window.close()}function EmptyText(e){("title for your content idea"==$("#"+e).val()||"someone@example.com"==$("#"+e).val())&&($("#"+e).val(""),$("#"+e).removeClass("inputTxt"))}function ValidateInput(){$("#errorInfo").empty();var e=$("#TitleInput").val(),t=$("#Description").val(),a=$("#BusiJustification").val(),i="Please provide values for ",s=" email address is invalid.",r=new Array;("title for your content idea"==e||""==e)&&r.push(" title");var l=GetSelectedValues("suggAssetTypeCks");""==l&&r.push(" SuggestedAssetType"),""==t&&r.push(" description"),""==a&&r.push(" BusinessJustification");var o=!0;if(0==$("#RequestedBy").val().trim().length)r.push(" email");else if(!ValidateEmailText("RequestedBy")){if(r.length>0)r.push(s);else{var c="<ul>";c+="<li>"+s+"</li>",c+="</ul>",$("#errorInfo").append(c)}o=!1}if(r.length>0&&(i+=r.join()),"please provide values for "!=i.toLowerCase()){var d="<ul>";d+="<li>"+i+"</li>",d+="</ul>",$("#errorInfo").append(d),o=!1}return o}function ValidateEmailText(e){var t=$("#"+e).val().trim();if(""==t)return!1;var a=new RegExp(/^[a-zA-Z0-9]+([._-]?[a-zA-Z0-9]+)+@\w+([\.-]\w+)*\.\w{2,4}$/),i=a.test($("#"+e).val());return i&&"someone@example.com"!=t.toLowerCase()?!0:!1}function GetSelectedValues(e){var t="";return $("#"+e+" input:checkbox:checked").each(function(){t+=escape($(this).val())+","}),t.substring(0,t.length-1)}function SaveTreeState(){var e="",t="",a="",i="",s="",r="";e=$("#tree").html(),e=escape(e),a=$("#tree").height(),i=$("#tree").width(),t=productVersion,r="<all id='allid' text='all' value='all' showcheck='false' complete='true' checkstate='0' isexpand='true' hasChildren='true'>",r=LoopNodes(allNodes[0].ChildNodes,r,0),r+="</all>",r=escape(r);var l=$("#txtProductTree").val();s=l.match(/\d+/)[0]}$(document).ready(function(){var e=window.dialogArguments;e&&(e.IsDetails?(ideaDerivedId=e.IdeaDerivedId,ShowDetails(ideaDerivedId),"success"==e.Status?$("#submitBtn").hide():$("#submitBtn").val("resubmit")):AutoFillInForm(e)),document.onclick=function(e){var t=e.target||e.srcElement;isHide?("bbit-tree-ec-icon bbit-tree-elbow-end-minus"!==t.className&&($("#searchDiv").fadeOut("slow"),$("#tree").fadeOut("slow"),$("#closeTreeDiv").fadeOut("slow")),$("#productsNameList span").html(""),$("#productsNameList").removeClass("productsNameListC")):isHide=!0},load(),$("#ProductTreeDiv").click(function(e){ShowProductTree(),e.stopPropagation()}),$("#txtProductTree").click(function(e){ShowProductTree(),e.stopPropagation()}),$("#tree_select_arrow").click(function(e){ShowProductTree(),e.stopPropagation()}),$("#confirmSelect").click(function(){return $("#tree").fadeOut(),$("#searchDiv").fadeOut(),$("#productsNameList span").html(""),$("#productsNameList").attr("class",""),$("#closeTreeDiv").fadeOut(),!1})});